<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guia do Aluno</title>
    <link rel="stylesheet" href="/style.css"/>
</head>
<body>
    
    <div id="interface">
         <header id="cabecalho">
            <img src="librasmath (1).png" alt="Logo Libras Math" class="logo-projeto"/>

         <nav id="menu">
            <h1>Menu principal</h1>
               <ul type="disc">
                   <li><a href="index.html">In√≠cio</a></li>
                   <li><a href="guia-aluno.html">Guia do Aluno</a></li>
                   <li><a href="guia-professor.html">Guia do Professor</a></li>
                   <li><a href="fale-conosco.html">Fale conosco</a></li>
               </ul>
         </nav>
    </div>

    <style>
        /* Estilos espec√≠ficos para a √°rea de mensagem */
        .mensagem-container {
            width: 90%;
            max-width: 700px;
            margin: 40px auto;
            padding: 30px;
            background-color: #f7fcfc; /* Fundo claro para destaque */
            border-left: 5px solid #176B87; /* Borda de destaque */
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
        }
        .mensagem-container h2 {
            color: #176B87;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        .icone-sino {
            margin-right: 10px;
            font-size: 1.5em;
        }
        #mensagem-recebida {
            white-space: pre-wrap; /* Preserva quebras de linha */
            font-size: 1.1em;
            line-height: 1.6;
            color: #333;
            padding: 15px;
            border: 1px dashed #C8DCE3;
            border-radius: 4px;
            min-height: 50px;
            background-color: #fff;
        }
        #mensagem-vazia {
            color: #999;
            font-style: italic;
            text-align: center;
        }
    </style>

<body>

    <script src="https://vlibras.gov.br/app/vlibras-plugin.js"></script>
    <script>
        new window.VLibras.Widget('https://vlibras.gov.br/app');
    </script>
    <section class="mensagem-container">
        <h2><span class="icone-sino">üîî</span> Comunicado do Professor</h2>
        <p style="color: #666; margin-bottom: 20px;">Esta √© a √∫ltima mensagem enviada pelo seu professor. Utilize o V-Libras para traduzir o conte√∫do abaixo.</p>
        
        <div id="mensagem-recebida">
            <p id="mensagem-vazia">Nenhuma mensagem nova do professor foi encontrada.</p>
        </div>
    </section>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var mensagemSalva = localStorage.getItem('mensagemProfessor');
            var divMensagem = document.getElementById('mensagem-recebida');
            var mensagemVazia = document.getElementById('mensagem-vazia');

            if (mensagemSalva) {
                // Exibe o conte√∫do e remove a mensagem padr√£o
                divMensagem.textContent = mensagemSalva;
                if (mensagemVazia) {
                    mensagemVazia.style.display = 'none';
                }
            } else {
                // Garante que a mensagem padr√£o seja exibida se n√£o houver conte√∫do
                divMensagem.innerHTML = '<p id="mensagem-vazia" style="color: #999; font-style: italic; text-align: center;">Nenhuma mensagem nova do professor foi encontrada.</p>';
            }
        });
    </script>
    <div id="video-form">
        <input type="text" id="videoId" placeholder="Digite o ID ou link do v√≠deo do YouTube" />
        <button id="carregar">Carregar v√≠deo</button>
    </div>

    <div id="video-container" style="display:none;">
        <iframe id="videoFrame" width="560" height="315" frameborder="0" allowfullscreen></iframe>
    </div>

    <div id="legendas" style="display:none;"></div>

    <div vw class="enabled">
        <div vw-access-button class="active"></div>
        <div vw-plugin-wrapper>
            <div class="vw-plugin-top-wrapper"></div>
        </div>
    </div>

         <script src="https://vlibras.gov.br/app/vlibras-plugin.js"></script>
    <script>
        new window.VLibras.Widget('https://vlibras.gov.br/app');

        const botao = document.getElementById('carregar');
        const videoInput = document.getElementById('videoId');
        const videoContainer = document.getElementById('video-container');
        const videoFrame = document.getElementById('videoFrame');
        const legendasDiv = document.getElementById('legendas');

        botao.addEventListener('click', async () => {
            let videoUrl = videoInput.value.trim();
            if (!videoUrl) {
                alert("Por favor, insira um ID ou link de v√≠deo do YouTube.");
                return;
            }

            let videoId = extrairVideoId(videoUrl);
            if (!videoId) {
                alert("ID de v√≠deo inv√°lido. Tente novamente.");
                return;
            }

            // Mostra o v√≠deo
            videoFrame.src = `https://www.youtube.com/embed/${videoId}`;
            videoContainer.style.display = "block";
            legendasDiv.style.display = "block";
            legendasDiv.innerHTML = "<h3>üìú Legendas do v√≠deo</h3><p>Carregando legendas...</p>";

            // ‚úÖ CHAMADA CORRETA PARA SUA API LOCAL
        try {
            const response = await fetch(`http://localhost:5000/api/transcript/${videoId}`);
            const data = await response.json();
            console.log("Resposta da API:", data);

            if (data.error) throw new Error(data.error);

            if (!data.snippets || !Array.isArray(data.snippets)) {
                throw new Error("Formato inesperado de resposta da API (campo 'snippets' ausente).");
            }

            const texto = data.snippets.map(line => line.text).join(" ");

            legendasDiv.innerHTML = `
                <h3>üìú Legendas do v√≠deo</h3>
                <p>${texto}</p>
            `;
        } catch (err) {
            legendasDiv.innerHTML = `
                <h3>üìú Legendas do v√≠deo</h3>
                <p>‚ùå N√£o foi poss√≠vel carregar as legendas: ${err.message}</p>
            `;
            console.error(err);
        }


        });

        function extrairVideoId(url) {
            try {
                if (/^[a-zA-Z0-9_-]{11}$/.test(url)) return url;
                const match = url.match(/[?&]v=([^&#]*)|youtu\.be\/([^&#]*)/);
                return match ? match[1] || match[2] : null;
            } catch {
                return null;
            }
        }
    </script>

    <footer id="rodape">
      <p>Copyright 2025 - by Libras Math <br>
      <a href="https://www.instagram.com/libras.math?igsh=c2lrYm8xcG5sYXNn" target="_blank">Instagram</a>
    </footer>
    
        </div>
</body>
</html>