<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guia do Aluno</title>
    <link rel="stylesheet" href="/style.css"/>
</head>
<body>
    
    <div id="interface">
         <header id="cabecalho">
            <img src="librasmath (1).png" alt="Logo Libras Math" class="logo-projeto"/>

         <nav id="menu">
            <h1>Menu principal</h1>
               <ul type="disc">
                   <li><a href="index.html">In√≠cio</a></li>
                   <li><a href="guia-aluno.html">Guia do Aluno</a></li>
                   <li><a href="guia-professor.html">Guia do Professor</a></li>
                   <li><a href="fale-conosco.html">Fale conosco</a></li>
               </ul>
         </nav>
    </div>

    <div id="video-form">
        <input type="text" id="videoId" placeholder="Digite o ID ou link do v√≠deo do YouTube" />
        <button id="carregar">Carregar v√≠deo</button>
    </div>

    <div id="video-container" style="display:none;">
        <iframe id="videoFrame" width="560" height="315" frameborder="0" allowfullscreen></iframe>
    </div>

    <div id="legendas" style="display:none;"></div>

    <div vw class="enabled">
        <div vw-access-button class="active"></div>
        <div vw-plugin-wrapper>
            <div class="vw-plugin-top-wrapper"></div>
        </div>
    </div>

         <script src="https://vlibras.gov.br/app/vlibras-plugin.js"></script>
    <script>
        new window.VLibras.Widget('https://vlibras.gov.br/app');

        const botao = document.getElementById('carregar');
        const videoInput = document.getElementById('videoId');
        const videoContainer = document.getElementById('video-container');
        const videoFrame = document.getElementById('videoFrame');
        const legendasDiv = document.getElementById('legendas');

        botao.addEventListener('click', async () => {
            let videoUrl = videoInput.value.trim();
            if (!videoUrl) {
                alert("Por favor, insira um ID ou link de v√≠deo do YouTube.");
                return;
            }

            let videoId = extrairVideoId(videoUrl);
            if (!videoId) {
                alert("ID de v√≠deo inv√°lido. Tente novamente.");
                return;
            }

            // Mostra o v√≠deo
            videoFrame.src = `https://www.youtube.com/embed/${videoId}`;
            videoContainer.style.display = "block";
            legendasDiv.style.display = "block";
            legendasDiv.innerHTML = "<h3>üìú Legendas do v√≠deo</h3><p>Carregando legendas...</p>";

            // ‚úÖ CHAMADA CORRETA PARA SUA API LOCAL
        try {
            const response = await fetch(`http://localhost:5000/api/transcript/${videoId}`);
            const data = await response.json();
            console.log("Resposta da API:", data);

            if (data.error) throw new Error(data.error);

            if (!data.snippets || !Array.isArray(data.snippets)) {
                throw new Error("Formato inesperado de resposta da API (campo 'snippets' ausente).");
            }

            const texto = data.snippets.map(line => line.text).join(" ");

            legendasDiv.innerHTML = `
                <h3>üìú Legendas do v√≠deo</h3>
                <p>${texto}</p>
            `;
        } catch (err) {
            legendasDiv.innerHTML = `
                <h3>üìú Legendas do v√≠deo</h3>
                <p>‚ùå N√£o foi poss√≠vel carregar as legendas: ${err.message}</p>
            `;
            console.error(err);
        }


        });

        function extrairVideoId(url) {
            try {
                if (/^[a-zA-Z0-9_-]{11}$/.test(url)) return url;
                const match = url.match(/[?&]v=([^&#]*)|youtu\.be\/([^&#]*)/);
                return match ? match[1] || match[2] : null;
            } catch {
                return null;
            }
        }
    </script>
        </div>
</body>
</html>